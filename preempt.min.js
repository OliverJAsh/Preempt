/**
 * preemt.js
 * ==========
 * https://github.com/bengourley/ticker
 * Licenced under the New BSD License
*/(function(){function t(n,r){if(!(this instanceof t))return new t(r);this.input=n,this.cursor=null,this.results=[],this.options=_.extend({},e,r),this.setup(),this.input.on("keyup",_.bind(this.handleKeyUp,this)),this.input.on("keydown",_.bind(this.handleKeyDown,this)),$(window).on("resize",_.bind(this.position,this))}var e={limit:5};t.prototype.setup=function(){this.input.attr("autocomplete","off"),this.root=$("<div/>").addClass("preempt-root"),this.container=$("<div/>").addClass("preempt-result-list"),this.position(),this.root.append(this.container),$("body").append(this.root),this.clear()},t.prototype.handleKeyUp=function(e){e.keyCode===27?this.clear():e.keyCode===38||e.keyCode===40?(this.container.find(".preempt-result").removeClass("cursor"),e.keyCode===40&&(this.cursor=this.cursor?this.cursor.next():this.container.find(".preempt-result").first(),this.cursor.length||(this.cursor=this.container.find(".preempt-result").last())),e.keyCode===38&&(this.cursor=this.cursor?this.cursor.prev():this.container.find(".preempt-result").last(),this.cursor.length||(this.cursor=this.container.find(".preempt-result").first())),this.cursor.addClass("cursor")):e.keyCode===13&&this.cursor.length?document.location.href=this.cursor.attr("href"):this.getResults(_.bind(function(e){this.results=e,this.render()},this))},t.prototype.handleKeyDown=function(e){e.keyCode===13&&this.cursor&&e.preventDefault(),(e.keyCode===38||e.keyCode===40)&&e.preventDefault()},t.prototype.getResults=function(e){if(this.input.val()==="")return e([]);this.options.query(this.input.val(),_.bind(function(t){e(t)},this))},t.prototype.clear=function(){this.results=[],this.cursor=null,this.container.hide()},t.prototype.render=function(){this.container.empty(),this.container.hide(),this.results.length&&(_.each(this.results,function(e,t){if(t>=this.options.limit)return;this.container.append($("<a/>").attr("href",e.link).text(e.text).addClass("preempt-result"))},this),this.container.show())},t.prototype.position=function(){this.root.css({left:this.input.offset().left,width:this.input.outerWidth(),top:this.input.offset().top+this.input.outerHeight()})},$.fn.preempt=function(e){return this.each(function(){return new t($(this),e)}),this}})();